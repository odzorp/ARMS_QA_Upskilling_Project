var d=function(e){return e.FAILED="failed",e.BROKEN="broken",e.PASSED="passed",e.SKIPPED="skipped",e}({}),Te=[d.FAILED,d.BROKEN,d.PASSED,d.SKIPPED],Ee=function(e){return e.SCHEDULED="scheduled",e.RUNNING="running",e.FINISHED="finished",e.PENDING="pending",e.INTERRUPTED="interrupted",e}({}),u=function(e){return e.ALLURE_ID="ALLURE_ID",e.AS_ID="ALLURE_ID",e.SUITE="suite",e.PARENT_SUITE="parentSuite",e.SUB_SUITE="subSuite",e.EPIC="epic",e.FEATURE="feature",e.STORY="story",e.SEVERITY="severity",e.TAG="tag",e.OWNER="owner",e.LEAD="lead",e.HOST="host",e.THREAD="thread",e.TEST_METHOD="testMethod",e.TEST_CLASS="testClass",e.PACKAGE="package",e.FRAMEWORK="framework",e.LANGUAGE="language",e.LAYER="layer",e}({}),xe=function(e){return e.BLOCKER="blocker",e.CRITICAL="critical",e.NORMAL="normal",e.MINOR="minor",e.TRIVIAL="trivial",e}({}),A=function(e){return e.TEXT="text/plain",e.XML="application/xml",e.HTML="text/html",e.CSV="text/csv",e.TSV="text/tab-separated-values",e.CSS="text/css",e.URI="text/uri-list",e.SVG="image/svg+xml",e.PNG="image/png",e.JSON="application/json",e.ZIP="application/zip",e.WEBM="video/webm",e.JPEG="image/jpeg",e.MP4="video/mp4",e.IMAGEDIFF="application/vnd.allure.image.diff",e}({}),M=function(e){return e.DEFAULT="link",e.ISSUE="issue",e.TMS="tms",e}({});function b(){b=function(n,o){return new r(n,void 0,o)};var e=RegExp.prototype,t=new WeakMap;function r(a,n,o){var i=RegExp(a,n);return t.set(i,o||t.get(a)),C(i,r.prototype)}function s(a,n){var o=t.get(n);return Object.keys(o).reduce(function(i,p){var g=o[p];if(typeof g=="number")i[p]=a[g];else{for(var f=0;a[g[f]]===void 0&&f+1<g.length;)f++;i[p]=a[g[f]]}return i},Object.create(null))}return _e(r,RegExp),r.prototype.exec=function(a){var n=e.exec.call(this,a);if(n){n.groups=s(n,this);var o=n.indices;o&&(o.groups=s(o,this))}return n},r.prototype[Symbol.replace]=function(a,n){if(typeof n=="string"){var o=t.get(this);return e[Symbol.replace].call(this,a,n.replace(/\$<([^>]+)>/g,function(p,g){var f=o[g];return"$"+(Array.isArray(f)?f.join("$"):f)}))}if(typeof n=="function"){var i=this;return e[Symbol.replace].call(this,a,function(){var p=arguments;return typeof p[p.length-1]!="object"&&(p=[].slice.call(p)).push(s(p,i)),n.apply(this,p)})}return e[Symbol.replace].call(this,a,n)},b.apply(this,arguments)}function _e(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&C(e,t)}function C(e,t){return C=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},C(e,t)}var v=e=>{switch(!0){case/assert/gi.test(e.constructor.name):case/expectation/gi.test(e.constructor.name):case/assert/gi.test(e.name):case/assert/gi.test(e.message):return d.FAILED;default:return d.BROKEN}},Me=function(){var{onlyFirst:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"].join("|");return new RegExp(r,t?void 0:"g")},w=e=>{var t=Me();return e.replace(t,"")},h=e=>{var{message:t,stack:r}=e;return{message:t?w(t):void 0,trace:r?w(r):void 0}},z=b(/(?:^|\s)@?allure\.id[:=]([^\s]+)/,{id:1}),be=new RegExp(z,"g"),Y=b(/(?:^|\s)@?allure\.label\.([^:=\s]+)[:=]([^\s]+)/,{name:1,value:2}),Ce=new RegExp(Y,"g");var D=e=>{var t=[];e.split(" ").forEach(s=>{var a,n=(a=s.match(z))===null||a===void 0||(a=a.groups)===null||a===void 0?void 0:a.id;n&&t.push({name:u.ALLURE_ID,value:n});var o=s.match(Y),{name:i,value:p}=o?.groups||{};i&&p&&t?.push({name:i,value:p})});var r=e.replace(Ce,"").replace(be,"").trim();return{labels:t,cleanTitle:r}};var Re=e=>e.reduce((t,r)=>{if(r.type!=="step_start"&&r.type!=="step_stop")return t;if(r.type==="step_start")return t.push([r]),t;var s=t.findLastIndex(a=>a.length===1);return s===-1||t[s].push(r),t},[]),I=e=>{var t=Re(e);return t.filter(r=>r.length===1)},k=e=>!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function";var S="__allure_report_system_hook__",E="__allure_report_step_command__";function W(e,t,r,s,a,n,o){try{var i=e[n](o),p=i.value}catch(g){return void r(g)}i.done?t(p):Promise.resolve(p).then(s,a)}function m(e){return function(){var t=this,r=arguments;return new Promise(function(s,a){var n=e.apply(t,r);function o(p){W(n,s,a,o,i,"next",p)}function i(p){W(n,s,a,o,i,"throw",p)}o(void 0)})}}var O=class{attachment(){var t=this;return m(function*(){yield t.warning()})()}attachmentFromPath(){var t=this;return m(function*(){yield t.warning()})()}description(){var t=this;return m(function*(){yield t.warning()})()}descriptionHtml(){var t=this;return m(function*(){yield t.warning()})()}displayName(){var t=this;return m(function*(){yield t.warning()})()}historyId(){var t=this;return m(function*(){yield t.warning()})()}labels(){var t=this;return m(function*(){yield t.warning()})()}links(){var t=this;return m(function*(){yield t.warning()})()}parameter(){var t=this;return m(function*(){yield t.warning()})()}logStep(){var t=this;return m(function*(){yield t.warning()})()}step(t,r){var s=this;return m(function*(){return yield s.warning(),r()})()}stepDisplayName(){var t=this;return m(function*(){yield t.warning()})()}stepParameter(){var t=this;return m(function*(){yield t.warning()})()}testCaseId(){var t=this;return m(function*(){yield t.warning()})()}warning(){return m(function*(){console.log("no test runtime is found. Please check test framework configuration")})()}},T=new O;var $="allureTestRuntime",N=e=>{globalThis[$]=()=>e},F=()=>globalThis?.[$],H=()=>{var e=F();if(e){var t;return(t=e())!==null&&t!==void 0?t:T}return T},L=()=>{var e=F();if(e){var t;return(t=e())!==null&&t!==void 0?t:T}if("_playwrightInstance"in globalThis)try{return(0,eval)("(() => import('allure-playwright/autoconfig'))()").then(()=>{var r,s;return(r=(s=F())===null||s===void 0?void 0:s())!==null&&r!==void 0?r:T})}catch(r){return console.log("can't execute allure-playwright/autoconfig",r),T}return T};var l=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];var n=L();return k(n)?n.then(o=>o[t](...s)):n[t](...s)},y=(e,t)=>l("labels",{name:e,value:t}),Pe=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return l("labels",...r)},U=(e,t,r)=>l("links",{url:e,type:r,name:t}),Ae=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return l("links",...r)},we=(e,t,r)=>l("parameter",e,t,r),De=e=>l("description",e),Ie=e=>l("descriptionHtml",e),ke=e=>l("displayName",e),Oe=e=>l("historyId",e),Fe=e=>l("testCaseId",e),Ne=(e,t,r)=>{var s=typeof r=="string"?{contentType:r}:r;return l("attachment",e,t,s)},He=(e,t,r)=>{var s=typeof r=="string"?{contentType:r}:r;return l("attachmentFromPath",e,t,s)},Le=()=>({displayName:e=>l("stepDisplayName",e),parameter:(e,t,r)=>l("stepParameter",e,t,r)}),Ue=(e,t,r)=>l("logStep",e,t,r),je=(e,t)=>l("step",e,()=>t(Le())),Ge=(e,t)=>U(e,t,M.ISSUE),Ve=(e,t)=>U(e,t,M.TMS),Be=e=>y(u.ALLURE_ID,e),Ke=e=>y(u.EPIC,e),ze=e=>y(u.FEATURE,e),Ye=e=>y(u.STORY,e),We=e=>y(u.SUITE,e),$e=e=>y(u.PARENT_SUITE,e),qe=e=>y(u.SUB_SUITE,e),Ze=e=>y(u.OWNER,e),Je=e=>y(u.SEVERITY,e),Xe=e=>y(u.LAYER,e),Qe=e=>y(u.TAG,e),et=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return l("labels",...r.map(a=>({name:u.TAG,value:a})))};var x=()=>{let e=Cypress.env("allure");return e||(e={initialized:!1,messages:[],testPlan:void 0},Cypress.env("allure",e)),e},q=()=>x().initialized,Z=()=>{x().initialized=!0},_=()=>x().messages,J=e=>{x().messages=e},c=e=>{_().push(e)},X=()=>x().testPlan;var Q=e=>Array.isArray(e)||e.buffer?btoa(String.fromCharCode.apply(null,e)):e;var j=e=>rt(e.attributes.args)?.log===!1||e.attributes.name==="task"&&e.attributes.args[0]==="reportAllureRuntimeMessages"||e.attributes.name==="then"||e.attributes.name==="wrap"&&e.attributes.args[0]===E;var rt=e=>e[e.length-1],G=(e,t)=>{let r=t.title,{cleanTitle:s,labels:a}=D(r),n=t.titlePath().slice(0,-1),o=`${e.relative}#${[...n,s].join(" ")}`;return{name:s,labels:a,fullName:o}},ee=(e,t)=>{let r=X();if(r){let s=[];for(let a=t;a;a=s.shift()){let n=at(r,e,a.tests);nt(a.tests,n),s.push(...a.suites)}}};var te=Symbol("The test was reported to Allure"),re=e=>{e[te]=!0},R=e=>e[te]===!0;var st=(e,t,r)=>e.tests.some(s=>r&&s.id?.toString()===r||s.selector===t),at=(e,t,r)=>{let s=[];return r.forEach((a,n)=>{let{fullName:o,labels:i}=G(t,a),p=i.find(({name:g})=>g===u.ALLURE_ID)?.value;st(e,o,p)||s.push(n)}),s},nt=(e,t)=>{for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)};var V=class{constructor(){this.#r()}labels(...t){return this.#e({type:"metadata",data:{labels:t}})}links(...t){return this.#e({type:"metadata",data:{links:t}})}parameter(t,r,s){return this.#e({type:"metadata",data:{parameters:[{name:t,value:r,...s}]}})}description(t){return this.#e({type:"metadata",data:{description:t}})}descriptionHtml(t){return this.#e({type:"metadata",data:{descriptionHtml:t}})}displayName(t){return this.#e({type:"metadata",data:{displayName:t}})}historyId(t){return this.#e({type:"metadata",data:{historyId:t}})}testCaseId(t){return this.#e({type:"metadata",data:{testCaseId:t}})}attachment(t,r,s){let a=r?.type==="Buffer"?r.data:r,n=typeof a=="string"?"utf8":"base64",o=Q(a);return this.#e({type:"attachment_content",data:{name:t,content:o,encoding:n,contentType:s.contentType,fileExtension:s.fileExtension}})}attachmentFromPath(t,r,s){return this.#e({type:"attachment_path",data:{name:t,path:r,contentType:s.contentType,fileExtension:s.fileExtension}})}logStep(t,r=d.PASSED,s){return cy.wrap(E,{log:!1}).then(()=>(this.#e({type:"step_start",data:{name:t,start:Date.now()}}),Cypress.Promise.resolve())).then(()=>this.#e({type:"step_stop",data:{status:r,stop:Date.now(),statusDetails:s?{...h(s)}:void 0}}))}step(t,r){return cy.wrap(E,{log:!1}).then(()=>(this.#e({type:"step_start",data:{name:t,start:Date.now()}}),Cypress.Promise.resolve(r()))).then(s=>this.#e({type:"step_stop",data:{status:d.PASSED,stop:Date.now()}}).then(()=>s))}stepDisplayName(t){return this.#e({type:"step_metadata",data:{name:t}})}stepParameter(t,r,s){return this.#e({type:"step_metadata",data:{parameters:[{name:t,value:r,mode:s}]}})}flushMessages=()=>this.#t("reportAllureCypressSpecMessages");flushFinalMessages=()=>this.#t("reportFinalAllureCypressSpecMessages");#t=t=>{let r=this.#s();return r.length?cy.task(t,{absolutePath:Cypress.spec.absolute,messages:r},{log:!1}):Cypress.Promise.resolve()};#r=()=>J([]);#e=t=>(c(t),Cypress.Promise.resolve());#s=()=>{let t=_();return this.#r(),t}},se=()=>N(new V),ae=()=>H(),P=()=>ae().flushMessages(),ne=()=>ae().flushFinalMessages(),oe=()=>{c({type:"cypress_run_start",data:{}})},ie=e=>{c({type:"cypress_suite_start",data:{name:e.title,root:!e.parent,start:Date.now()}})},pe=e=>{c({type:"cypress_suite_end",data:{root:!e.parent,stop:Date.now()}})},ue=e=>{c({type:"cypress_hook_start",data:{name:e.title,start:Date.now()}})},le=e=>{c({type:"cypress_hook_end",data:{duration:e.duration??0}})},B=(e,t)=>{let r=G(Cypress.spec,e);t&&r.labels.push({name:"reported",value:t}),c({type:"cypress_test_start",data:{...r,start:e.wallClockStartedAt?.getTime()||Date.now()}}),re(e)},K=(e,t)=>{let r=_();I(r).forEach(()=>{c({type:"step_stop",data:{stop:Date.now(),status:e,statusDetails:t}})})},ce=()=>{K(d.PASSED),c({type:"cypress_test_pass",data:{}})},de=e=>{R(e)?fe(d.SKIPPED,{message:"The test was skipped before the command was completed"}):B(e),c({type:"cypress_test_skip",data:{}})},me=e=>{c({type:"cypress_command_start",data:{name:`Command "${e.attributes.name}"`,args:e.attributes.args.map(t=>typeof t=="string"?t:JSON.stringify(t,null,2)),start:Date.now()}})},ye=()=>{c({type:"cypress_command_end",data:{status:d.PASSED,stop:Date.now()}})},ge=(e,t)=>{c({type:"attachment_path",data:{path:e,name:t||"Screenshot",contentType:A.PNG}})},fe=(e,t)=>{let r=_(),s=r.toReversed().findIndex(({type:i})=>i==="cypress_command_start"),a=r.toReversed().findIndex(({type:i})=>i==="cypress_command_end"),n=s>a,o={status:e,stop:Date.now()};t&&(o.statusDetails=t),n&&c({type:"cypress_command_end",data:o})},he=e=>{let t=v(e),r=h(e);fe(t,r),c({type:"cypress_fail",data:{status:t,statusDetails:r}})},ve=e=>{c({type:"cypress_test_end",data:{duration:e.duration??0,retries:e._retries??0}})},ot=(e,...t)=>{let[r,s,a]=t;return typeof a>"u"&&typeof s>"u"?e(r):typeof s=="function"?e(r,s):e(r,s,a)},it=(e,t)=>{let r=n=>(o,i,p)=>{e();try{return ot(n,o,i,p)}finally{t()}},s=globalThis.describe,a=r(s);a.only=r(s.only),a.skip=r(s.skip),globalThis.describe=a},pt=()=>{let e=0;return[()=>e,()=>{e++},()=>{e--}]},ut=e=>{let t=globalThis.after,r=(s,a)=>{try{return typeof s=="string"?t(s,a):t(s)}finally{e()===0&&t(S,()=>{P()})}};globalThis.after=r},Se=()=>{let[e,t,r]=pt();it(t,r),ut(e)};var{EVENT_RUN_BEGIN:lt,EVENT_SUITE_BEGIN:ct,EVENT_SUITE_END:dt,EVENT_HOOK_BEGIN:mt,EVENT_HOOK_END:yt,EVENT_TEST_BEGIN:gt,EVENT_TEST_PASS:ft,EVENT_TEST_FAIL:ht,EVENT_TEST_PENDING:vt,EVENT_TEST_END:St,EVENT_RUN_END:Tt}=Mocha.Runner.constants,Et=()=>{q()||(Z(),Cypress.mocha.getRunner().on(lt,()=>{se(),oe()}).on(ct,e=>{e.parent||ee(Cypress.spec,e),ie(e)}).on(dt,e=>{pe(e)}).on(mt,e=>{e.title.includes(S)||ue(e)}).on(yt,e=>{e.title.includes(S)||le(e)}).on(gt,e=>{R(e)||B(e)}).on(ft,()=>{ce()}).on(ht,(e,t)=>{he(t)}).on(vt,e=>{de(e)}).on(St,e=>{ve(e)}).on(Tt,()=>{Cypress.config("isInteractive")&&ne()}),Cypress.Screenshot.defaults({onAfterScreenshot:(e,{path:t,name:r})=>{ge(t,r)}}),Cypress.on("fail",e=>{let t=v(e),r=h(e);throw K(t,r),e}),Cypress.on("command:start",e=>{j(e)||me(e)}),Cypress.on("command:end",e=>{j(e)||ye()}),afterEach(S,()=>{P()}),after(S,()=>{P()}),Se())};Et();export{A as ContentType,u as LabelName,M as LinkType,xe as Severity,Ee as Stage,d as Status,Te as StatusByPriority,Be as allureId,Ne as attachment,He as attachmentPath,De as description,Ie as descriptionHtml,ke as displayName,Ke as epic,ze as feature,Oe as historyId,Ge as issue,y as label,Pe as labels,Xe as layer,U as link,Ae as links,Ue as logStep,Ze as owner,we as parameter,$e as parentSuite,Je as severity,je as step,Ye as story,qe as subSuite,We as suite,Qe as tag,et as tags,Fe as testCaseId,Ve as tms};
//# sourceMappingURL=index.js.map
