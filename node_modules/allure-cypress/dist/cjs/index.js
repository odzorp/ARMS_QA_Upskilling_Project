"use strict";var D=Object.defineProperty;var Ze=Object.getOwnPropertyDescriptor;var Je=Object.getOwnPropertyNames;var Xe=Object.prototype.hasOwnProperty;var Qe=(e,t)=>{for(var r in t)D(e,r,{get:t[r],enumerable:!0})},et=(e,t,r,s)=>{if(t&&typeof t=="object"||typeof t=="function")for(let a of Je(t))!Xe.call(e,a)&&a!==r&&D(e,a,{get:()=>t[a],enumerable:!(s=Ze(t,a))||s.enumerable});return e};var tt=e=>et(D({},"__esModule",{value:!0}),e);var At={};Qe(At,{ContentType:()=>b,LabelName:()=>u,LinkType:()=>E,Severity:()=>$,Stage:()=>W,Status:()=>l,StatusByPriority:()=>Y,allureId:()=>me,attachment:()=>ie,attachmentPath:()=>pe,description:()=>re,descriptionHtml:()=>se,displayName:()=>ae,epic:()=>ye,feature:()=>ge,historyId:()=>ne,issue:()=>ce,label:()=>y,labels:()=>Q,layer:()=>xe,link:()=>P,links:()=>ee,logStep:()=>ue,owner:()=>Te,parameter:()=>te,parentSuite:()=>ve,severity:()=>Ee,step:()=>le,story:()=>fe,subSuite:()=>Se,suite:()=>he,tag:()=>_e,tags:()=>Me,testCaseId:()=>oe,tms:()=>de});module.exports=tt(At);var l=function(e){return e.FAILED="failed",e.BROKEN="broken",e.PASSED="passed",e.SKIPPED="skipped",e}({}),Y=[l.FAILED,l.BROKEN,l.PASSED,l.SKIPPED],W=function(e){return e.SCHEDULED="scheduled",e.RUNNING="running",e.FINISHED="finished",e.PENDING="pending",e.INTERRUPTED="interrupted",e}({}),u=function(e){return e.ALLURE_ID="ALLURE_ID",e.AS_ID="ALLURE_ID",e.SUITE="suite",e.PARENT_SUITE="parentSuite",e.SUB_SUITE="subSuite",e.EPIC="epic",e.FEATURE="feature",e.STORY="story",e.SEVERITY="severity",e.TAG="tag",e.OWNER="owner",e.LEAD="lead",e.HOST="host",e.THREAD="thread",e.TEST_METHOD="testMethod",e.TEST_CLASS="testClass",e.PACKAGE="package",e.FRAMEWORK="framework",e.LANGUAGE="language",e.LAYER="layer",e}({}),$=function(e){return e.BLOCKER="blocker",e.CRITICAL="critical",e.NORMAL="normal",e.MINOR="minor",e.TRIVIAL="trivial",e}({}),b=function(e){return e.TEXT="text/plain",e.XML="application/xml",e.HTML="text/html",e.CSV="text/csv",e.TSV="text/tab-separated-values",e.CSS="text/css",e.URI="text/uri-list",e.SVG="image/svg+xml",e.PNG="image/png",e.JSON="application/json",e.ZIP="application/zip",e.WEBM="video/webm",e.JPEG="image/jpeg",e.MP4="video/mp4",e.IMAGEDIFF="application/vnd.allure.image.diff",e}({}),E=function(e){return e.DEFAULT="link",e.ISSUE="issue",e.TMS="tms",e}({});function C(){C=function(n,o){return new r(n,void 0,o)};var e=RegExp.prototype,t=new WeakMap;function r(a,n,o){var i=RegExp(a,n);return t.set(i,o||t.get(a)),R(i,r.prototype)}function s(a,n){var o=t.get(n);return Object.keys(o).reduce(function(i,p){var g=o[p];if(typeof g=="number")i[p]=a[g];else{for(var f=0;a[g[f]]===void 0&&f+1<g.length;)f++;i[p]=a[g[f]]}return i},Object.create(null))}return rt(r,RegExp),r.prototype.exec=function(a){var n=e.exec.call(this,a);if(n){n.groups=s(n,this);var o=n.indices;o&&(o.groups=s(o,this))}return n},r.prototype[Symbol.replace]=function(a,n){if(typeof n=="string"){var o=t.get(this);return e[Symbol.replace].call(this,a,n.replace(/\$<([^>]+)>/g,function(p,g){var f=o[g];return"$"+(Array.isArray(f)?f.join("$"):f)}))}if(typeof n=="function"){var i=this;return e[Symbol.replace].call(this,a,function(){var p=arguments;return typeof p[p.length-1]!="object"&&(p=[].slice.call(p)).push(s(p,i)),n.apply(this,p)})}return e[Symbol.replace].call(this,a,n)},C.apply(this,arguments)}function rt(e,t){if(typeof t!="function"&&t!==null)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),Object.defineProperty(e,"prototype",{writable:!1}),t&&R(e,t)}function R(e,t){return R=Object.setPrototypeOf?Object.setPrototypeOf.bind():function(r,s){return r.__proto__=s,r},R(e,t)}var v=e=>{switch(!0){case/assert/gi.test(e.constructor.name):case/expectation/gi.test(e.constructor.name):case/assert/gi.test(e.name):case/assert/gi.test(e.message):return l.FAILED;default:return l.BROKEN}},st=function(){var{onlyFirst:t=!1}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},r=["[\\u001B\\u009B][[\\]()#;?]*(?:(?:(?:(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]+)*|[a-zA-Z\\d]+(?:;[-a-zA-Z\\d\\/#&.:=?%@~_]*)*)?\\u0007)","(?:(?:\\d{1,4}(?:;\\d{0,4})*)?[\\dA-PR-TZcf-nq-uy=><~]))"].join("|");return new RegExp(r,t?void 0:"g")},I=e=>{var t=st();return e.replace(t,"")},h=e=>{var{message:t,stack:r}=e;return{message:t?I(t):void 0,trace:r?I(r):void 0}},q=C(/(?:^|\s)@?allure\.id[:=]([^\s]+)/,{id:1}),at=new RegExp(q,"g"),Z=C(/(?:^|\s)@?allure\.label\.([^:=\s]+)[:=]([^\s]+)/,{name:1,value:2}),nt=new RegExp(Z,"g");var k=e=>{var t=[];e.split(" ").forEach(s=>{var a,n=(a=s.match(q))===null||a===void 0||(a=a.groups)===null||a===void 0?void 0:a.id;n&&t.push({name:u.ALLURE_ID,value:n});var o=s.match(Z),{name:i,value:p}=o?.groups||{};i&&p&&t?.push({name:i,value:p})});var r=e.replace(nt,"").replace(at,"").trim();return{labels:t,cleanTitle:r}};var ot=e=>e.reduce((t,r)=>{if(r.type!=="step_start"&&r.type!=="step_stop")return t;if(r.type==="step_start")return t.push([r]),t;var s=t.findLastIndex(a=>a.length===1);return s===-1||t[s].push(r),t},[]),O=e=>{var t=ot(e);return t.filter(r=>r.length===1)},F=e=>!!e&&(typeof e=="object"||typeof e=="function")&&typeof e.then=="function";var S="__allure_report_system_hook__",x="__allure_report_step_command__";function J(e,t,r,s,a,n,o){try{var i=e[n](o),p=i.value}catch(g){return void r(g)}i.done?t(p):Promise.resolve(p).then(s,a)}function m(e){return function(){var t=this,r=arguments;return new Promise(function(s,a){var n=e.apply(t,r);function o(p){J(n,s,a,o,i,"next",p)}function i(p){J(n,s,a,o,i,"throw",p)}o(void 0)})}}var N=class{attachment(){var t=this;return m(function*(){yield t.warning()})()}attachmentFromPath(){var t=this;return m(function*(){yield t.warning()})()}description(){var t=this;return m(function*(){yield t.warning()})()}descriptionHtml(){var t=this;return m(function*(){yield t.warning()})()}displayName(){var t=this;return m(function*(){yield t.warning()})()}historyId(){var t=this;return m(function*(){yield t.warning()})()}labels(){var t=this;return m(function*(){yield t.warning()})()}links(){var t=this;return m(function*(){yield t.warning()})()}parameter(){var t=this;return m(function*(){yield t.warning()})()}logStep(){var t=this;return m(function*(){yield t.warning()})()}step(t,r){var s=this;return m(function*(){return yield s.warning(),r()})()}stepDisplayName(){var t=this;return m(function*(){yield t.warning()})()}stepParameter(){var t=this;return m(function*(){yield t.warning()})()}testCaseId(){var t=this;return m(function*(){yield t.warning()})()}warning(){return m(function*(){console.log("no test runtime is found. Please check test framework configuration")})()}},T=new N;var X="allureTestRuntime",L=e=>{globalThis[X]=()=>e},H=()=>globalThis?.[X],U=()=>{var e=H();if(e){var t;return(t=e())!==null&&t!==void 0?t:T}return T},j=()=>{var e=H();if(e){var t;return(t=e())!==null&&t!==void 0?t:T}if("_playwrightInstance"in globalThis)try{return(0,eval)("(() => import('allure-playwright/autoconfig'))()").then(()=>{var r,s;return(r=(s=H())===null||s===void 0?void 0:s())!==null&&r!==void 0?r:T})}catch(r){return console.log("can't execute allure-playwright/autoconfig",r),T}return T};var c=function(t){for(var r=arguments.length,s=new Array(r>1?r-1:0),a=1;a<r;a++)s[a-1]=arguments[a];var n=j();return F(n)?n.then(o=>o[t](...s)):n[t](...s)},y=(e,t)=>c("labels",{name:e,value:t}),Q=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("labels",...r)},P=(e,t,r)=>c("links",{url:e,type:r,name:t}),ee=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("links",...r)},te=(e,t,r)=>c("parameter",e,t,r),re=e=>c("description",e),se=e=>c("descriptionHtml",e),ae=e=>c("displayName",e),ne=e=>c("historyId",e),oe=e=>c("testCaseId",e),ie=(e,t,r)=>{var s=typeof r=="string"?{contentType:r}:r;return c("attachment",e,t,s)},pe=(e,t,r)=>{var s=typeof r=="string"?{contentType:r}:r;return c("attachmentFromPath",e,t,s)},it=()=>({displayName:e=>c("stepDisplayName",e),parameter:(e,t,r)=>c("stepParameter",e,t,r)}),ue=(e,t,r)=>c("logStep",e,t,r),le=(e,t)=>c("step",e,()=>t(it())),ce=(e,t)=>P(e,t,E.ISSUE),de=(e,t)=>P(e,t,E.TMS),me=e=>y(u.ALLURE_ID,e),ye=e=>y(u.EPIC,e),ge=e=>y(u.FEATURE,e),fe=e=>y(u.STORY,e),he=e=>y(u.SUITE,e),ve=e=>y(u.PARENT_SUITE,e),Se=e=>y(u.SUB_SUITE,e),Te=e=>y(u.OWNER,e),Ee=e=>y(u.SEVERITY,e),xe=e=>y(u.LAYER,e),_e=e=>y(u.TAG,e),Me=function(){for(var t=arguments.length,r=new Array(t),s=0;s<t;s++)r[s]=arguments[s];return c("labels",...r.map(a=>({name:u.TAG,value:a})))};var _=()=>{let e=Cypress.env("allure");return e||(e={initialized:!1,messages:[],testPlan:void 0},Cypress.env("allure",e)),e},be=()=>_().initialized,Ce=()=>{_().initialized=!0},M=()=>_().messages,Re=e=>{_().messages=e},d=e=>{M().push(e)},Pe=()=>_().testPlan;var Ae=e=>Array.isArray(e)||e.buffer?btoa(String.fromCharCode.apply(null,e)):e;var G=e=>ut(e.attributes.args)?.log===!1||e.attributes.name==="task"&&e.attributes.args[0]==="reportAllureRuntimeMessages"||e.attributes.name==="then"||e.attributes.name==="wrap"&&e.attributes.args[0]===x;var ut=e=>e[e.length-1],V=(e,t)=>{let r=t.title,{cleanTitle:s,labels:a}=k(r),n=t.titlePath().slice(0,-1),o=`${e.relative}#${[...n,s].join(" ")}`;return{name:s,labels:a,fullName:o}},we=(e,t)=>{let r=Pe();if(r){let s=[];for(let a=t;a;a=s.shift()){let n=ct(r,e,a.tests);dt(a.tests,n),s.push(...a.suites)}}};var De=Symbol("The test was reported to Allure"),Ie=e=>{e[De]=!0},A=e=>e[De]===!0;var lt=(e,t,r)=>e.tests.some(s=>r&&s.id?.toString()===r||s.selector===t),ct=(e,t,r)=>{let s=[];return r.forEach((a,n)=>{let{fullName:o,labels:i}=V(t,a),p=i.find(({name:g})=>g===u.ALLURE_ID)?.value;lt(e,o,p)||s.push(n)}),s},dt=(e,t)=>{for(let r=t.length-1;r>=0;r--)e.splice(t[r],1)};var B=class{constructor(){this.#r()}labels(...t){return this.#e({type:"metadata",data:{labels:t}})}links(...t){return this.#e({type:"metadata",data:{links:t}})}parameter(t,r,s){return this.#e({type:"metadata",data:{parameters:[{name:t,value:r,...s}]}})}description(t){return this.#e({type:"metadata",data:{description:t}})}descriptionHtml(t){return this.#e({type:"metadata",data:{descriptionHtml:t}})}displayName(t){return this.#e({type:"metadata",data:{displayName:t}})}historyId(t){return this.#e({type:"metadata",data:{historyId:t}})}testCaseId(t){return this.#e({type:"metadata",data:{testCaseId:t}})}attachment(t,r,s){let a=r?.type==="Buffer"?r.data:r,n=typeof a=="string"?"utf8":"base64",o=Ae(a);return this.#e({type:"attachment_content",data:{name:t,content:o,encoding:n,contentType:s.contentType,fileExtension:s.fileExtension}})}attachmentFromPath(t,r,s){return this.#e({type:"attachment_path",data:{name:t,path:r,contentType:s.contentType,fileExtension:s.fileExtension}})}logStep(t,r=l.PASSED,s){return cy.wrap(x,{log:!1}).then(()=>(this.#e({type:"step_start",data:{name:t,start:Date.now()}}),Cypress.Promise.resolve())).then(()=>this.#e({type:"step_stop",data:{status:r,stop:Date.now(),statusDetails:s?{...h(s)}:void 0}}))}step(t,r){return cy.wrap(x,{log:!1}).then(()=>(this.#e({type:"step_start",data:{name:t,start:Date.now()}}),Cypress.Promise.resolve(r()))).then(s=>this.#e({type:"step_stop",data:{status:l.PASSED,stop:Date.now()}}).then(()=>s))}stepDisplayName(t){return this.#e({type:"step_metadata",data:{name:t}})}stepParameter(t,r,s){return this.#e({type:"step_metadata",data:{parameters:[{name:t,value:r,mode:s}]}})}flushMessages=()=>this.#t("reportAllureCypressSpecMessages");flushFinalMessages=()=>this.#t("reportFinalAllureCypressSpecMessages");#t=t=>{let r=this.#s();return r.length?cy.task(t,{absolutePath:Cypress.spec.absolute,messages:r},{log:!1}):Cypress.Promise.resolve()};#r=()=>Re([]);#e=t=>(d(t),Cypress.Promise.resolve());#s=()=>{let t=M();return this.#r(),t}},ke=()=>L(new B),Oe=()=>U(),w=()=>Oe().flushMessages(),Fe=()=>Oe().flushFinalMessages(),Ne=()=>{d({type:"cypress_run_start",data:{}})},He=e=>{d({type:"cypress_suite_start",data:{name:e.title,root:!e.parent,start:Date.now()}})},Le=e=>{d({type:"cypress_suite_end",data:{root:!e.parent,stop:Date.now()}})},Ue=e=>{d({type:"cypress_hook_start",data:{name:e.title,start:Date.now()}})},je=e=>{d({type:"cypress_hook_end",data:{duration:e.duration??0}})},K=(e,t)=>{let r=V(Cypress.spec,e);t&&r.labels.push({name:"reported",value:t}),d({type:"cypress_test_start",data:{...r,start:e.wallClockStartedAt?.getTime()||Date.now()}}),Ie(e)},z=(e,t)=>{let r=M();O(r).forEach(()=>{d({type:"step_stop",data:{stop:Date.now(),status:e,statusDetails:t}})})},Ge=()=>{z(l.PASSED),d({type:"cypress_test_pass",data:{}})},Ve=e=>{A(e)?Ye(l.SKIPPED,{message:"The test was skipped before the command was completed"}):K(e),d({type:"cypress_test_skip",data:{}})},Be=e=>{d({type:"cypress_command_start",data:{name:`Command "${e.attributes.name}"`,args:e.attributes.args.map(t=>typeof t=="string"?t:JSON.stringify(t,null,2)),start:Date.now()}})},Ke=()=>{d({type:"cypress_command_end",data:{status:l.PASSED,stop:Date.now()}})},ze=(e,t)=>{d({type:"attachment_path",data:{path:e,name:t||"Screenshot",contentType:b.PNG}})},Ye=(e,t)=>{let r=M(),s=r.toReversed().findIndex(({type:i})=>i==="cypress_command_start"),a=r.toReversed().findIndex(({type:i})=>i==="cypress_command_end"),n=s>a,o={status:e,stop:Date.now()};t&&(o.statusDetails=t),n&&d({type:"cypress_command_end",data:o})},We=e=>{let t=v(e),r=h(e);Ye(t,r),d({type:"cypress_fail",data:{status:t,statusDetails:r}})},$e=e=>{d({type:"cypress_test_end",data:{duration:e.duration??0,retries:e._retries??0}})},mt=(e,...t)=>{let[r,s,a]=t;return typeof a>"u"&&typeof s>"u"?e(r):typeof s=="function"?e(r,s):e(r,s,a)},yt=(e,t)=>{let r=n=>(o,i,p)=>{e();try{return mt(n,o,i,p)}finally{t()}},s=globalThis.describe,a=r(s);a.only=r(s.only),a.skip=r(s.skip),globalThis.describe=a},gt=()=>{let e=0;return[()=>e,()=>{e++},()=>{e--}]},ft=e=>{let t=globalThis.after,r=(s,a)=>{try{return typeof s=="string"?t(s,a):t(s)}finally{e()===0&&t(S,()=>{w()})}};globalThis.after=r},qe=()=>{let[e,t,r]=gt();yt(t,r),ft(e)};var{EVENT_RUN_BEGIN:ht,EVENT_SUITE_BEGIN:vt,EVENT_SUITE_END:St,EVENT_HOOK_BEGIN:Tt,EVENT_HOOK_END:Et,EVENT_TEST_BEGIN:xt,EVENT_TEST_PASS:_t,EVENT_TEST_FAIL:Mt,EVENT_TEST_PENDING:bt,EVENT_TEST_END:Ct,EVENT_RUN_END:Rt}=Mocha.Runner.constants,Pt=()=>{be()||(Ce(),Cypress.mocha.getRunner().on(ht,()=>{ke(),Ne()}).on(vt,e=>{e.parent||we(Cypress.spec,e),He(e)}).on(St,e=>{Le(e)}).on(Tt,e=>{e.title.includes(S)||Ue(e)}).on(Et,e=>{e.title.includes(S)||je(e)}).on(xt,e=>{A(e)||K(e)}).on(_t,()=>{Ge()}).on(Mt,(e,t)=>{We(t)}).on(bt,e=>{Ve(e)}).on(Ct,e=>{$e(e)}).on(Rt,()=>{Cypress.config("isInteractive")&&Fe()}),Cypress.Screenshot.defaults({onAfterScreenshot:(e,{path:t,name:r})=>{ze(t,r)}}),Cypress.on("fail",e=>{let t=v(e),r=h(e);throw z(t,r),e}),Cypress.on("command:start",e=>{G(e)||Be(e)}),Cypress.on("command:end",e=>{G(e)||Ke()}),afterEach(S,()=>{w()}),after(S,()=>{w()}),qe())};Pt();
//# sourceMappingURL=index.js.map
